local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- GUI setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BondUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = cloneref(game:GetService("CoreGui"))

-- "Collecting Bonds..." label at the top
local collectingLabel = Instance.new("TextLabel")
collectingLabel.Size = UDim2.new(0.3, 0, 0.1, 0)
collectingLabel.Position = UDim2.new(0.35, 0, 0.35, 0)
collectingLabel.BackgroundTransparency = 1
collectingLabel.TextScaled = true
collectingLabel.Font = Enum.Font.SourceSansBold
collectingLabel.TextColor3 = Color3.new(1, 1, 1)
collectingLabel.TextStrokeTransparency = 0.5
collectingLabel.Text = "Collecting Bonds..."
collectingLabel.Parent = screenGui

-- "Bond Collected: X" label below
local bondLabel = Instance.new("TextLabel")
bondLabel.Size = UDim2.new(0.3, 0, 0.1, 0)
bondLabel.Position = UDim2.new(0.35, 0, 0.45, 0)
bondLabel.BackgroundTransparency = 1
bondLabel.TextScaled = true
bondLabel.Font = Enum.Font.SourceSansBold
bondLabel.TextColor3 = Color3.new(1, 1, 1)
bondLabel.TextStrokeTransparency = 0.5
bondLabel.Text = "Bond Collected: 0"
bondLabel.Parent = screenGui

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local root = character:WaitForChild("HumanoidRootPart")
local lockedY = root.Position.Y

local activateRemote = ReplicatedStorage:WaitForChild("Shared")
	:WaitForChild("Network")
	:WaitForChild("RemotePromise")
	:WaitForChild("Remotes")
	:WaitForChild("C_ActivateObject")

local function findNearestBond()
	local closest, shortestDist = nil, math.huge
	for _, item in ipairs(workspace.RuntimeItems:GetDescendants()) do
		if item:IsA("Model") and item.Name:lower() == "bond" then
			local primary = item.PrimaryPart or item:FindFirstChildWhichIsA("BasePart")
			if primary then
				local dist = (primary.Position - root.Position).Magnitude
				if dist < shortestDist then
					shortestDist = dist
					closest = item
				end
			end
		end
	end
	return closest
end

-- Lock Y-axis to avoid falling during tweens
task.spawn(function()
	while true do
		if root and root.Parent then
			local pos = root.Position
			root.Velocity = Vector3.new(root.Velocity.X, 0, root.Velocity.Z)
			root.CFrame = CFrame.new(pos.X, lockedY, pos.Z)
		end
		task.wait()
	end
end)

local bondCount = 0

-- Teleport to bond and attempt to collect
local function teleportTo(bond)
	local primary = bond.PrimaryPart or bond:FindFirstChildWhichIsA("BasePart")
	if not primary then return end

	root.CFrame = primary.CFrame + Vector3.new(0, 5, 0)

	local startTime = os.clock()
	while bond.Parent and os.clock() - startTime < 1 do
		activateRemote:FireServer(bond)
		task.wait(0.1)
	end

	if not bond.Parent then
		bondCount += 1
		bondLabel.Text = "Bond Collected: " .. bondCount
		task.wait(0.5)
		collectingLabel.Text = "Collecting Bonds..."
	else
		print("Failed to take bond within timeout.")
	end
end

local activeTween = nil
local travelTime = 1
local function tweenTo(pos)
	if activeTween then
		activeTween:Cancel()
	end

	local tweenInfo = TweenInfo.new(travelTime, Enum.EasingStyle.Linear)
	local goal = {CFrame = CFrame.new(pos)}
	activeTween = TweenService:Create(root, tweenInfo, goal)

	local finished = false
	local lastTweenStart = os.clock()

	local connection
	connection = activeTween.Completed:Connect(function()
		finished = true
		if connection then connection:Disconnect() end
	end)

	activeTween:Play()

	while not finished do
		local bond = findNearestBond()
		if bond then
			activeTween:Cancel()
			teleportTo(bond)
			return
		end

		if os.clock() - lastTweenStart > 5 and not finished then
			warn("Tween possibly stuck, retrying...")
			return tweenTo(pos)
		end

		task.wait(0.1)
	end
end

-- Start collecting
bondLabel.Text = "Bond Collected: 0"
collectingLabel.Text = "Collecting Bonds..."

local layerSize = 2048
local halfSize = layerSize / 2
local xStart = -halfSize
local xEnd = halfSize
local y = -50
local zStart = 30000
local zEnd = -49872
local zStep = -layerSize

while true do
	local bond = findNearestBond()
	if bond then
		teleportTo(bond)
	else
		break
	end
	task.wait(0.05)
end

-- Zig-zag scan + bond collection
local z = zStart
local direction = 1
while (zStep < 0 and z >= zEnd) or (zStep > 0 and z <= zEnd) do
	local startX = direction == 1 and xStart or xEnd
	local endX = direction == 1 and xEnd or xStart

	local startPos = Vector3.new(startX, y, z)
	local endPos = Vector3.new(endX, y, z)

	tweenTo(startPos)
	tweenTo(endPos)

	z += zStep
	direction *= -1
end

task.wait(2)
Players.LocalPlayer:Kick("Autofarm Completed, Total Bond: " .. bondCount)
